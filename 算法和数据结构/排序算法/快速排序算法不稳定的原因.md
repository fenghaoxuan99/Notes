

#### 2. 快速排序为什么不稳定？

快速排序的不稳定性主要来源于**分区（partition）过程**。在分区时，相等的元素可能会因为交换操作而改变相对顺序。具体原因：

1. **交换操作**：在分区过程中，当遇到与基准元素相等的元素时，可能会被交换到另一侧，从而导致相等元素的相对顺序改变。
   
2. **随机性**：快速排序的基准选择是随机的，如果基准元素是重复的，分区时可能会打乱其他相等元素的顺序。

**例子**：
假设数组 `[3a, 2, 3b, 1]`（`3a` 和 `3b` 是值相同的不同元素）：
- 选择 `3a` 为基准，分区后可能变为 `[1, 2, 3b, 3a]`，此时 `3a` 和 `3b` 的相对顺序改变了。

---




#### 3. 如何将快速排序优化为稳定排序？

快速排序本身是**不稳定**的，但可以通过以下方法**间接实现稳定**：

##### 方法 1：使用额外空间（类似归并排序）
- **原理**：牺牲空间复杂度，用额外空间存储元素和其原始位置信息。
- **步骤**：
  1. 为每个元素附加一个唯一标识（如原始下标）。
  2. 在比较时，如果值相同，则按原始下标排序。
  3. 分区时确保相等元素的相对顺序不变。
- **缺点**：空间复杂度从 O(log n) 上升到 O(n)，且实现复杂。

##### 方法 2：三路快速排序 + 稳定分区
- **原理**：将数组分为 `< pivot`、`= pivot` 和 `> pivot` 三部分，并对 `= pivot` 的部分保持原始顺序。
- **步骤**：
  1. 分区时记录相等元素的区间。
  2. 递归排序时跳过相等部分。
- **缺点**：仍可能因交换操作导致不稳定。

##### 方法 3：改用归并排序
- **直接建议**：如果需要稳定排序，优先选择**归并排序**（时间复杂度同样为 O(n log n)，且天然稳定）。


#### 总结
- 快速排序不稳定是因为分区时的交换操作可能打乱相等元素的顺序。
- 可以通过附加唯一标识或改用归并排序实现稳定，但会牺牲空间或效率。
- 在工程中，若需稳定排序，优先选择归并排序或基数排序。


二叉树最大深度的叶子节点
寻找无重复最长子串