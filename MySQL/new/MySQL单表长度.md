
**核心问题：** “MySQL 单表不要超过 2000W 行” 这个经验值是否可靠？其依据是什么？

**关键内容补充说明：**

1.  **问题来源：** 这是数据库领域常见的经验性建议，声称单表超过约 2000 万行可能导致查询性能下降，需要考虑数据迁移。
2.  **实验观察：** 在特定测试环境下（MySQL 8.0，非专用数据库服务器），数据量达到 2000W 行后，查询耗时确实出现显著上升。
3.  **理论依据分析：**
    *   **表结构与存储：** InnoDB 表数据存储在表空间文件（`.ibd`）中，数据被划分为固定大小（16KB）的“页”。
    *   **索引结构：** InnoDB 使用 B+ 树索引。索引页和数据页大小均为 16KB。
    *   **页容量计算：**
        *   **非叶子节点（索引页）：** 存储主键（假设 BIGINT, 8B）和页号（4B）。扣除页头页尾等固定开销（约 1KB），剩余空间可存储约 `(15KB) / (8B + 4B) ≈ 1280` 条索引记录（指向子页）。
        *   **叶子节点（数据页）：** 存储实际行数据。行大小直接影响容量。假设单行数据 1KB，扣除固定开销后，一页可存储约 `15KB / 1KB ≈ 15` 行。
    *   **B+ 树容量模型：**
        *   `x` = 非叶子节点可容纳的子页指针数 ≈ 1280
        *   `y` = 叶子节点可容纳的行数（取决于行大小）
        *   `z` = B+ 树层数
        *   **总行数 ≈ `x^(z-1) * y`**
    *   **2000W 的由来：** 基于典型配置（`x≈1280`, `y≈15`, `z=3`）计算：`1280^(3-1) * 15 = 1280^2 * 15 = 1,638,400 * 15 ≈ 24,576,000` (约 2457 万)。这与常见的 2000W 建议值接近。
4.  **2000W 并非绝对限制：**
    *   **行大小是关键：** 如果单行数据更大（如 5KB），则 `y≈3`。同样三层 B+ 树，总行数 ≈ `1280^2 * 3 ≈ 4.9 百万`。行越大，在相同层级下能存储的总行数越少。
    *   **B+ 树层级影响性能：** 超过 2000W 后，可能导致 B+ 树层级增加到 4 层或更高。查询时需要访问更多磁盘页（更多磁盘 I/O），显著降低查询性能。
    *   **其他影响因素：** 服务器内存（InnoDB Buffer Pool 大小）、数据库版本、具体查询语句、硬件配置等都会影响实际性能表现。
5.  **结论：**
    *   **2000W 是经验参考值，非硬性限制。** 它是基于典型行大小（~1KB）和三层 B+ 树结构推算出的一个合理阈值。
    *   **核心问题是 B+ 树层级。** 当数据量增长导致 B+ 树层级增加时，查询所需的磁盘 I/O 次数增多，性能会下降。
    *   **实际容量取决于行大小。** 行越大，达到性能拐点的数据量越小。
    *   **硬件优化可提升阈值：** 足够大的内存（能将索引和热点数据完全放入 Buffer Pool）可以缓解磁盘 I/O 压力，允许存储更多数据而不显著影响性能。

**总结提炼：** “MySQL 单表不要超过 2000W 行” 的建议主要源于 **B+ 树索引结构在典型配置（行大小约 1KB）下三层结构所能容纳的数据量上限（约 2450 万行）**。超过这个量级，B+ 树层级增加的风险变大，导致查询性能下降（更多磁盘 I/O）。该值并非绝对，**实际可支撑的行数受单行数据大小、内存配置等因素显著影响**。理解其背后的原理（B+ 树层级与磁盘 I/O）比记住具体数字更重要。