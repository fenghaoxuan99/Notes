# Linux 系统核心组件与目录结构详解

## 一、Linux 内核五大子系统

### 1. 进程调度
Linux 采用多任务调度机制，支持多种调度策略：
- **SCHED_OTHER**：分时调度策略（默认），采用时间片轮转算法，适用于普通进程
- **SCHED_FIFO**：实时调度策略（先进先出），适用于实时性要求高、运行时间短的进程
- **SCHED_RR**：实时调度策略（轮转），适用于实时性要求高且运行时间较长的进程

补充说明：实时策略的进程优先级高于普通进程，系统会优先执行实时进程。

### 2. 内存管理
- 采用虚拟内存技术，使进程可使用超过物理内存容量的地址空间
- 每个进程拥有独立的虚拟地址空间，避免内存冲突
- 支持内存共享机制，提高资源利用率

补充说明：Linux 使用分页机制和页面置换算法（如LRU）来管理内存。

### 3. 虚拟文件系统(VFS)
- 提供统一的文件系统接口，支持多种文件系统：
  - 传统文件系统：ext、ext2、ext3、ext4
  - Windows兼容：vfat、ntfs
  - 特殊用途：proc（进程信息）、sysfs（设备信息）
  - 网络文件系统：nfs、smb
  - 光盘文件系统：iso9660

补充说明：ext4是目前最常用的日志文件系统，具有更好的性能和可靠性。

### 4. 网络接口
- 支持多种网络协议：TCP/IP、IPX、AppleTalk等
- 丰富的网络设备驱动支持
- 网络协议栈分层实现，包括：
  - 物理层
  - 数据链路层
  - 网络层
  - 传输层
  - 应用层

### 5. 进程间通信(IPC)
- **管道(Pipe)**：单向数据流，用于有亲缘关系的进程
- **命名管道(FIFO)**：可用于无亲缘关系的进程
- **信号(Signal)**：异步通知机制
- **消息队列**：结构化数据交换
- **共享内存**：最高效的IPC方式
- **信号量**：进程同步机制
- **套接字(Socket)**：支持网络通信

## 二、Linux 目录结构详解

### 核心目录及其功能

| 目录 | 用途说明 | 补充说明 |
|------|----------|----------|
| / | 根目录 | 所有目录的起点 |
| /bin | 基本命令二进制文件 | 普通用户和root都可使用 |
| /sbin | 系统管理命令 | 通常只有root权限可用 |
| /etc | 系统配置文件 | 包含各种服务的配置 |
| /lib | 系统库文件 | 包括.so动态库和.a静态库 |
| /media | 可移动设备挂载点 | 自动挂载U盘、光盘等 |
| /mnt | 临时挂载目录 | 手动挂载文件系统 |
| /proc | 虚拟文件系统 | 反映内核和进程状态 |
| /tmp | 临时文件 | 定期清理 |
| /boot | 启动相关文件 | 内核、grub配置等 |
| /home | 用户家目录 | 每个用户一个子目录 |
| /root | root用户家目录 | 与/home分开 |
| /dev | 设备文件 | 包括字符设备和块设备 |
| /opt | 第三方软件安装目录 | 大型商业软件常安装于此 |
| /var | 可变数据文件 | 日志、邮件、数据库等 |
| /usr | 系统资源目录 | 包含多个子目录 |

### /usr 子目录说明
- /usr/bin：用户命令
- /usr/sbin：系统管理命令
- /usr/lib：库文件
- /usr/include：头文件
- /usr/share：架构无关数据
- /usr/local：本地安装软件
- /usr/src：源代码

## 三、常用终端快捷键

| 快捷键 | 功能 | 等效操作 |
|--------|------|----------|
| Tab | 命令/文件名自动补全 | - |
| Ctrl+P | 显示上一条历史命令 | ↑ |
| Ctrl+N | 显示下一条历史命令 | ↓ |
| Ctrl+A | 光标移至行首 | Home |
| Ctrl+E | 光标移至行尾 | End |
| Ctrl+U | 删除光标前所有内容 | - |
| Ctrl+K | 删除光标后所有内容 | - |
| Ctrl+R | 搜索历史命令 | - |
| Ctrl+L | 清屏 | clear命令 |
| Ctrl+C | 终止当前命令 | - |
| Ctrl+D | 退出终端/结束输入 | - |

补充说明：
1. 连续按两次Tab可显示所有可能的补全选项
2. Ctrl+Z可将当前任务挂起到后台
3. 使用`fg`命令可将后台任务调回前台

## 四、用户提示符
- `#`：root用户提示符
- `$`：普通用户提示符

# Linux 文件系统与权限管理详解

## 一、Linux 文件类型与颜色标识

| 文件类型标识 | 文件类型说明 | 终端显示颜色 |
|--------------|--------------|--------------|
| - | 普通文件 | 白色（默认）、红色（压缩包）、绿色（可执行程序） |
| d | 目录(directory) | 蓝色（普通）、绿色背景（权限全开放） |
| l | 软链接(link) | 淡蓝色/青色 |
| c | 字符设备(char) | 黄色 |
| b | 块设备(block) | 黄色 |
| p | 管道文件(pipe) | 棕黄色 |
| s | 套接字文件(socket) | 粉色 |

补充说明：
- 文件颜色显示可通过`LS_COLORS`环境变量自定义
- 使用`ls --color=auto`命令可显示彩色输出

## 二、Linux 用户与权限体系

### 1. 用户分类
- **文件所有者(u:user)**：文件创建者，拥有最高控制权
- **文件所属组(g:group)**：文件所属用户组，组内成员共享权限
- **其他人(o:other)**：既非所有者也不在所属组的用户

### 2. 权限类型
| 权限标识 | 权限名称 | 对文件的影响 | 对目录的影响 |
|----------|----------|--------------|--------------|
| r | 读(read) | 查看文件内容 | 列出目录内容 |
| w | 写(write) | 修改文件内容 | 创建/删除目录内文件 |
| x | 执行(execute) | 执行文件 | 进入目录 |

### 3. 权限表示法示例
```
-rwxrw-r-- 1 user group 1024 Jan 1 10:00 example
```
- 第1字符：文件类型（-表示普通文件）
- 2-4字符：所有者权限（rwx）
- 5-7字符：所属组权限（rw-）
- 8-10字符：其他人权限（r--）
- 数字1：硬链接计数
- user/group：所有者/所属组
- 1024：文件大小（字节）
- Jan 1 10:00：最后修改时间
- example：文件名

## 三、常用文件操作命令

### 1. cp 命令（文件/目录复制）
```bash
# 文件复制
cp 源文件 目标文件          # 基本文件复制
cp 文件A 文件B            # 文件A复制为文件B
cp 文件A 已存在文件B      # 文件A覆盖文件B

# 目录复制（需加-r参数）
cp -r 源目录 目标目录      # 目录复制
cp -r 目录A 已存在目录B   # 目录A内容复制到目录B中
cp A/* B -r              # 复制A中所有内容到B目录
```

### 2. 链接创建
#### 软链接（符号链接）
```bash
ln -s 源文件路径 链接路径
# 示例：创建跨目录软链接
ln -s /path/to/source /path/to/link
```
特点：
- 类似Windows快捷方式
- 可跨文件系统
- 源文件删除后链接失效

#### 硬链接
```bash
ln 源文件 链接文件
# 示例：创建硬链接
ln file.txt hardlink.txt
```
特点：
- 多个文件名指向同一inode
- 不能跨文件系统
- 源文件删除不影响链接文件
- 硬链接计数增加

### 3. chmod 命令（权限修改）
```bash
# 基本语法
chmod [who][操作符][权限] 文件

# 权限设置示例
chmod u=rwx file      # 所有者设为读写执行
chmod g+rx file       # 所属组添加读执行权限
chmod o-w file        # 其他人移除写权限
chmod a=rw file       # 所有人设为读写权限

# 数字模式（推荐）
chmod 755 file        # rwxr-xr-x
chmod 644 file        # rw-r--r--
```

### 4. 重定向操作
```bash
# 输出重定向
command > file       # 覆盖写入
command >> file      # 追加写入

# 示例
ls > dirlist.txt     # 将目录列表写入文件
echo "text" >> log   # 追加文本到日志文件
```

## 四、补充说明

### 1. 权限数字表示法
- r=4, w=2, x=1
- 例如：rwxr-xr-- = 754

### 2. 特殊权限位
- SUID(4)：执行时以所有者身份运行
- SGID(2)：执行时以所属组身份运行
- Sticky(1)：目录内文件仅所有者可删除

### 3. 实用技巧
- 使用`ls -l`查看详细文件信息
- `file`命令可检测实际文件类型
- `stat`命令查看文件详细信息（包括inode）
- 使用`umask`设置默认创建文件权限


添加删除用户组
默认情况下, 只要创建新用户就会得到一个同名的用户组, 并且这个用户属于这个组。一般情况下不需要创建新的用户组，如果有需求可以使用 groupadd添加用户组, 使用 groupdel删除用户组。

由于普通用户没有添加删除用户组权限，因此需要在管理员（root）用户下操作，或者在普通用户下借助管理员权限完成该操作。


# 基于普通用户创建新的用户组
$ sudo groupadd 组名

# 基于普通用户删除已经存在的用户组
$ sudo groupdel 组名

修改密码
Linux中设置用户密码和修改用户密码的方式是一样的, 修改用户密码又分几种情况: 修改当前用户密码, 普通用户A修改其他普通用户密码, 普通用户A修改root用户密码, root用户修改普通用户密码。修改密码需要使用passwd命令。当创建了一个普通用户却没有提示指定密码, 或者忘记了用户密码都可以通过该命令来实现自己重置密码的需求。

当前用户修改自己的密码, 默认是有权限操作的
当前普通用户修改其他用户密码, 默认没有权限, 需要借助管理员权限才能完成操作
当前普通用户修改root用户密码, 默认没有权限, 需要借助管理员权限才能完成操作
root用户修改其他普通用户密码, 默认有权限, 可以直接修改

# passwd
# 修改当前用户
$ passwd

# 修改非当前用户密码
$ sudo passwd 用户名

# 修改root
$ sudo passwd root

