
### **HTTP/1.1 优化策略**  
**核心目标：** 提升 HTTP/1.1 性能  
**优化方向：**  
1. 避免发送 HTTP 请求  
2. 减少 HTTP 请求次数  
3. 减小 HTTP 响应数据体积  

---

#### **一、避免发送 HTTP 请求：缓存技术**  
1. **缓存机制**  
   - 首次请求后，将 `URL` 作为 key，响应数据作为 value 存储于本地。  
   - 后续相同请求直接读取本地缓存（磁盘读取 >> 网络请求）。  

2. **缓存更新策略**  
   - 服务器响应头中设置过期时间（如 `Cache-Control`）。  
   - 缓存过期时，客户端携带摘要（如 `Etag`）重新请求：  
     - 若资源未变 → 服务器返回 **`304 Not Modified`**（无响应体），客户端复用缓存。  
     - 若资源更新 → 服务器返回新资源。  

---

#### **二、减少 HTTP 请求次数**  
1. **减少重定向**  
   - **问题**：服务端重定向（如 `302`）导致客户端多次请求。  
   - **优化**：  
     - 将重定向逻辑移交代理服务器处理（减少客户端-代理服务器交互）。  
     - 使用 `301`/`308` 永久重定向并缓存规则。  

2. **合并请求**  
   - **CSS Sprites**：将多个小图标合并为一张大图，通过 CSS 定位显示。  
   - **资源打包**：用工具（如 Webpack）合并 JS/CSS 文件。  
   - **Base64 嵌入**：将图片编码为 Base64 直接嵌入 HTML。  
   - **代价**：资源变更时需重新下载整个合并文件。  

3. **按需加载（延迟发送）**  
   - 首屏仅加载必要资源（如当前可视区域内容）。  
   - 用户滚动时动态加载后续资源。  

---

#### **三、减小 HTTP 响应数据体积**  
1. **无损压缩（文本/代码）**  
   - **步骤**：  
     1. 删除冗余字符（空格、换行符）。  
     2. 使用统计模型压缩（如 **霍夫曼编码**）。  
   - **常用算法**：`gzip`、`br`（Brotli，效率更高）。  
   - **头部字段**：  
     - 客户端声明支持算法：`Accept-Encoding: gzip, deflate, br`  
     - 服务器返回算法：`Content-Encoding: gzip`  

2. **有损压缩（多媒体资源）**  
   - **原理**：舍弃次要数据，牺牲部分质量换取体积减小。  
   - **优化方案**：  
     - **图片**：使用 **WebP 格式**（较 PNG 平均节省 30% 体积）。  
     - **音视频**：  
       - 利用帧间时序关系压缩（如关键帧+增量数据）。  
       - 视频编码：H.264/H.265；音频编码：AAC/AC3。  
   - **质量控制**：客户端通过 `Accept` 头部指定质量因子（如 `q=0.8`）。  

---

### **总结**  
| **优化方向**     | **具体措施**                                          |
|-----------------|-----------------------------------------------------|
| **避免发送请求**  | 本地缓存 + `304 Not Modified` 响应复用                 |
| **减少请求次数**  | 代理处理重定向、资源合并（CSS Sprites/打包）、按需加载     |
| **减小响应体积**  | 无损压缩（`gzip`/`br`） + 有损压缩（WebP 图片/H.265 视频 |

