# Linux 内核 vs Windows 内核

## 内核的核心功能
内核作为应用与硬件的桥梁，提供四大核心能力：
1. **进程调度**：管理进程/线程，分配CPU资源
2. **内存管理**：控制内存分配与回收
3. **硬件通信**：为进程与硬件设备提供通信能力
4. **系统调用**：提供用户程序与操作系统的接口

## 内核工作模式
| 模式        | 权限级别     | 内存访问范围       |
|-------------|-------------|-------------------|
| **用户态**  | 低权限       | 仅限用户空间      |
| **内核态**  | 高权限       | 全部内存空间      |

**系统调用流程**：
1. 用户程序触发系统调用
2. CPU中断当前任务，跳转至内核态执行中断处理程序
3. 内核完成处理后主动交回CPU控制权
4. CPU返回用户态继续执行

---

## Linux 内核设计
### 核心特性
1. **多任务（MultiTask）**
   - 单核CPU：任务并发执行（时间片轮转）
   - 多核CPU：任务并行执行

2. **对称多处理（SMP）**
   - 所有CPU地位平等
   - 共享完整内存和硬件资源
   - 任意程序可分配到任意CPU执行

3. **可执行文件格式（ELF）**
   - 分段结构：Program header table（运行时所需段） + Section header table（段首地址）
   - 生成流程：  
     `源码 → 编译器 → 汇编代码 → 汇编器 → 目标文件 → 链接器 → ELF文件`
   - 执行流程：ELF文件通过装载器载入内存 → CPU读取执行

4. **宏内核架构（Monolithic Kernel）**
   - 所有核心模块（进程调度/内存管理/文件系统等）运行在内核态
   - 支持动态加载模块（如设备驱动）

---

## Windows 内核设计
### 核心特性
- **内核类型**：混合内核（Hybrid Kernel）
  - 基础层为微内核（MicroKernel）
  - 上层构建完整功能模块
- **可执行文件格式**：PE（可移植执行文件）
  - 扩展名：`.exe`, `.dll`, `.sys`等
  - 结构类似ELF但互不兼容

---

## 内核架构对比
| 架构类型   | 特点                                                                 | 代表系统                |
|------------|----------------------------------------------------------------------|-------------------------|
| **宏内核** | 所有模块集成在内核态，高性能但稳定性风险高                           | Linux                   |
| **微内核** | 仅核心功能在内核态，服务模块在用户态，高稳定性但性能损耗             | 鸿蒙OS                  |
| **混合内核**| 微内核基础+宏内核实现方式，平衡性能与稳定性                          | Windows NT（Win7/Win10）|

---

## 关键差异总结
| 对比维度       | Linux                          | Windows                     |
|----------------|--------------------------------|-----------------------------|
| **内核类型**   | 宏内核                         | 混合内核                    |
| **文件格式**   | ELF                            | PE                          |
| **模块化**     | 支持动态加载内核模块           | 类似宏内核的模块集成        |
| **对称多处理** | 完全支持                       | 支持                        |
| **开源协议**   | 完全开源                       | 闭源                        |
